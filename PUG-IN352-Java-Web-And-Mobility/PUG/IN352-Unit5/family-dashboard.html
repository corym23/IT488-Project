<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f2f5; }
    header { background-color: #446688; color: white; padding: 20px; text-align: center; }
    .dashboard-container { max-width: 900px; margin: 40px auto; padding: 30px; background: white; border-radius: 10px; box-shadow: 0 0 16px rgba(0,0,0,0.12); }
    h2 { color: #446688; text-align: center; }
    .dashboard-section { margin: 30px 0; }
    .dashboard-section h3 { color: #365570; margin-bottom: 10px; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin-top: 15px; }
    .photo-placeholder { background-color: #e0e0e0; border-radius: 8px; padding-top: 100%; position: relative; }
    .add-photo-btn { background: #446688; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
    .add-photo-btn:hover { background: #365570; }
    .logout-btn { background: #c0392b; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; float: right; margin-top: -40px; }
    .logout-btn:hover { background: #a93226; }
    @media (max-width: 600px) {
      .dashboard-container { margin: 15px; padding: 10px; }
    }
  </style>
</head>
<body>
  <!-- Edit Member Modal -->
  <div id="editMemberModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:1000;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:28px 24px 18px 24px;border-radius:8px;max-width:340px;width:90vw;box-shadow:0 4px 24px rgba(0,0,0,0.18);position:relative;">
      <h3 style="margin-top:0;color:#446688;">Edit Family Member</h3>
      <form id="editMemberForm">
        <label for="editFname">First Name</label>
        <input type="text" id="editFname" style="width:100%;margin-bottom:10px;" required>
        <label for="editLname">Last Name</label>
        <input type="text" id="editLname" style="width:100%;margin-bottom:10px;" required>
        <label for="editDob">Birthdate</label>
        <input type="date" id="editDob" style="width:100%;margin-bottom:16px;" required>
        <div style="display:flex;gap:10px;justify-content:flex-end;">
          <button type="button" id="cancelEditBtn" style="background:#888;color:#fff;border:none;border-radius:4px;padding:6px 16px;cursor:pointer;">Cancel</button>
          <button type="submit" style="background:#446688;color:#fff;border:none;border-radius:4px;padding:6px 16px;cursor:pointer;">Save</button>
        </div>
      </form>
      <button id="closeEditModal" style="position:absolute;top:8px;right:8px;background:#000;color:#fff;border:none;border-radius:50%;width:28px;height:28px;cursor:pointer;font-size:16px;">‚úñ</button>
    </div>
  </div>
  <header>
    <h1>Family Dashboard</h1>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </header>
  <div class="dashboard-container">
    <h2>Welcome to Your Family Dashboard!</h2>
    <div class="dashboard-section">
      <h3>Family Members</h3>
      <div style="margin-bottom:10px;display:flex;gap:8px;align-items:center;">
        <button id="selectAllBtn" type="button" style="background:#446688;color:#fff;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;font-size:13px;">Select All</button>
        <button id="deselectAllBtn" type="button" style="background:#888;color:#fff;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;font-size:13px;">Deselect All</button>
        <button id="deleteSelectedBtn" type="button" style="background:#000;color:#fff;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;font-size:13px;">Delete Selected</button>
        <button id="editSelectedBtn" type="button" style="background:#365570;color:#fff;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;font-size:13px;">Edit Selected</button>
      </div>
      <ul id="memberList"></ul>
      <form id="addMemberForm" style="margin-top:20px;">
        <input type="text" id="newFname" placeholder="First Name" required>
        <input type="text" id="newLname" placeholder="Last Name" required>
        <input type="date" id="newDob" required>
        <button class="add-photo-btn" type="submit">Add Member</button>
      </form>
    </div>
    <div class="dashboard-section">
      <h3>Recent Family Photos & Videos</h3>
      <div id="dropArea" style="border:2px dashed #446688;border-radius:8px;padding:18px;text-align:center;margin-bottom:18px;background:#f8faff;transition:background 0.2s;">
        <span id="dropText">Drag & drop photos or videos here, or use the form below.</span>
      </div>
      <div class="gallery" id="mediaGallery"></div>
      <form id="addMediaForm" style="margin-top:20px;">
        <input type="file" id="mediaFile" accept="image/*,video/*" required>
        <button class="add-photo-btn" type="submit">Add Photo/Video</button>
      </form>
    </div>
    <div class="dashboard-section">
      <h3>Family Announcements</h3>
      <ul>
        <li>üéâ McCombs Family Reunion on August 20th!</li>
        <li>üéÇ Happy Birthday to Jason!</li>
        <li>üèÜ Congrats to Carl for winning the spelling bee!</li>
      </ul>
    </div>
    <div class="dashboard-section">
      <h3>Upcoming Events</h3>
      <ul>
        <li>Picnic at Central Park - August 15</li>
        <li>Grandma's 80th Birthday - September 2</li>
      </ul>
    </div>
  </div>
  <script>
    // Drag and drop support for media upload
    const dropArea = document.getElementById('dropArea');
    const dropText = document.getElementById('dropText');
    dropArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      dropArea.style.background = '#e3eaf7';
      dropText.textContent = 'Release to upload your file(s)';
    });
    dropArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      dropArea.style.background = '#f8faff';
      dropText.textContent = 'Drag & drop photos or videos here, or use the form below.';
    });
    dropArea.addEventListener('drop', function(e) {
      e.preventDefault();
      dropArea.style.background = '#f8faff';
      dropText.textContent = 'Drag & drop photos or videos here, or use the form below.';
      const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/') || f.type.startsWith('video/'));
      if (files.length === 0) return;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(evt) {
          let media = JSON.parse(localStorage.getItem('familyMedia') || '[]');
          media.push({ data: evt.target.result, type: file.type });
          localStorage.setItem('familyMedia', JSON.stringify(media));
          renderMedia();
        };
        reader.readAsDataURL(file);
      });
    });
    function logout() {
      window.location.href = 'in352-family.html';
    }

    // Modal logic for editing member
    let editingMemberIdx = null;
    function openEditModal(idx, member) {
      editingMemberIdx = idx;
      document.getElementById('editFname').value = member.fname;
      document.getElementById('editLname').value = member.lname;
      document.getElementById('editDob').value = member.dob;
      document.getElementById('editMemberModal').style.display = 'flex';
    }
    function closeEditModal() {
      document.getElementById('editMemberModal').style.display = 'none';
      editingMemberIdx = null;
    }
    document.getElementById('closeEditModal').onclick = closeEditModal;
    document.getElementById('cancelEditBtn').onclick = function(e) { e.preventDefault(); closeEditModal(); };
    document.getElementById('editMemberModal').addEventListener('click', function(e) {
      if (e.target === this) closeEditModal();
    });
    document.getElementById('editMemberForm').onsubmit = function(e) {
      e.preventDefault();
      let members = JSON.parse(localStorage.getItem('familyMembers') || '[]');
      if (editingMemberIdx !== null && members[editingMemberIdx]) {
        members[editingMemberIdx] = {
          fname: document.getElementById('editFname').value.trim(),
          lname: document.getElementById('editLname').value.trim(),
          dob: document.getElementById('editDob').value
        };
        localStorage.setItem('familyMembers', JSON.stringify(members));
        closeEditModal();
        renderMembers();
      }
    };

    function renderMembers() {
      const memberList = document.getElementById('memberList');
      let members = JSON.parse(localStorage.getItem('familyMembers') || '[]');
      memberList.innerHTML = '';
      if (members.length === 0) {
        memberList.innerHTML = '<li>No family members yet.</li>';
      } else {
        members.forEach((m, i) => {
          const li = document.createElement('li');
          li.style = 'display:flex;align-items:center;gap:8px;';

          // Checkbox
          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.className = 'member-cb';
          cb.dataset.idx = i;
          li.appendChild(cb);

          const infoSpan = document.createElement('span');
          infoSpan.textContent = `${m.fname} ${m.lname} (Born: ${m.dob})`;
          li.appendChild(infoSpan);

          // Edit button
          const editBtn = document.createElement('button');
          editBtn.textContent = 'Edit';
          editBtn.style = 'margin-left:8px;background:#446688;color:#fff;border:none;border-radius:4px;padding:2px 10px;cursor:pointer;font-size:13px;';
          editBtn.onclick = function() {
            openEditModal(i, m);
          };
          li.appendChild(editBtn);

          // Delete button styled like Edit
          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'Delete';
          deleteBtn.title = 'Remove';
          deleteBtn.style = 'margin-left:4px;background:#c0392b;color:#fff;border:none;border-radius:4px;padding:2px 10px;cursor:pointer;font-size:13px;';
          deleteBtn.onclick = function() {
            if (confirm('Are you sure you want to remove this family member?')) {
              members.splice(i, 1);
              localStorage.setItem('familyMembers', JSON.stringify(members));
              renderMembers();
            }
          };
          li.appendChild(deleteBtn);

          memberList.appendChild(li);
        });
      }
    // Select All/Deselect All/Batch Delete/Batch Edit logic
    document.getElementById('selectAllBtn').onclick = function() {
      document.querySelectorAll('.member-cb').forEach(cb => cb.checked = true);
    };
    document.getElementById('deselectAllBtn').onclick = function() {
      document.querySelectorAll('.member-cb').forEach(cb => cb.checked = false);
    };
    document.getElementById('deleteSelectedBtn').onclick = function() {
      let members = JSON.parse(localStorage.getItem('familyMembers') || '[]');
      const cbs = Array.from(document.querySelectorAll('.member-cb'));
      const toDelete = cbs.map((cb, idx) => cb.checked ? idx : -1).filter(idx => idx !== -1);
      if (toDelete.length === 0) { alert('No members selected.'); return; }
      if (confirm('Are you sure you want to delete the selected member(s)?')) {
        // Remove from last to first to avoid index shift
        toDelete.reverse().forEach(idx => members.splice(idx, 1));
        localStorage.setItem('familyMembers', JSON.stringify(members));
        renderMembers();
      }
    };
    document.getElementById('editSelectedBtn').onclick = function() {
      let members = JSON.parse(localStorage.getItem('familyMembers') || '[]');
      const cbs = Array.from(document.querySelectorAll('.member-cb'));
      const toEdit = cbs.map((cb, idx) => cb.checked ? idx : -1).filter(idx => idx !== -1);
      if (toEdit.length === 0) { alert('No members selected.'); return; }
      toEdit.forEach(idx => {
        const m = members[idx];
        const newFname = prompt('Edit First Name:', m.fname) || m.fname;
        const newLname = prompt('Edit Last Name:', m.lname) || m.lname;
        const newDob = prompt('Edit Birthdate (YYYY-MM-DD):', m.dob) || m.dob;
        if (newFname && newLname && newDob) {
          members[idx] = { fname: newFname, lname: newLname, dob: newDob };
        }
      });
      localStorage.setItem('familyMembers', JSON.stringify(members));
      renderMembers();
    };
    }

    // Render media (photos/videos) from localStorage
    function renderMedia() {
      const gallery = document.getElementById('mediaGallery');
      let media = JSON.parse(localStorage.getItem('familyMedia') || '[]');
      gallery.innerHTML = '';
      if (media.length === 0) {
        gallery.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#888;">No photos or videos yet.</div>';
      } else {
        media.forEach((item, idx) => {
          let el;
          if (item.type.startsWith('image/')) {
            el = document.createElement('img');
            el.src = item.data;
            el.alt = 'Family Photo';
            el.style = 'width:100%;height:200px;border-radius:8px;object-fit:contain;background:#fff;display:block;pointer-events:none;';
          } else if (item.type.startsWith('video/')) {
            el = document.createElement('video');
            el.src = item.data;
            el.controls = true;
            el.style = 'width:100%;border-radius:8px;max-height:200px;object-fit:cover;background:#000;pointer-events:none;';
          }
          const wrap = document.createElement('div');
          wrap.className = 'photo-placeholder';
          wrap.style = 'padding:0;display:flex;align-items:center;justify-content:center;min-height:100px;position:relative;overflow:hidden;';
          wrap.appendChild(el);

          // Add remove button (black background, confirmation, overlayed on image)
          const removeBtn = document.createElement('button');
          removeBtn.textContent = '‚úñ';
          removeBtn.title = 'Remove';
          removeBtn.style = 'position:absolute;top:10px;right:10px;background:#000;color:#fff;border:none;border-radius:50%;width:28px;height:28px;cursor:pointer;font-size:16px;z-index:3;display:flex;align-items:center;justify-content:center;opacity:0.85;pointer-events:auto;box-shadow:0 2px 6px rgba(0,0,0,0.15);';
          removeBtn.onclick = function(e) {
            e.stopPropagation();
            if (confirm('Are you sure you want to delete this file?')) {
              let mediaArr = JSON.parse(localStorage.getItem('familyMedia') || '[]');
              mediaArr.splice(idx, 1);
              localStorage.setItem('familyMedia', JSON.stringify(mediaArr));
              renderMedia();
            }
          };
          wrap.appendChild(removeBtn);

          gallery.appendChild(wrap);
        });
      }
    }

    // Add member form handler
    document.getElementById('addMemberForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const fname = document.getElementById('newFname').value.trim();
      const lname = document.getElementById('newLname').value.trim();
      const dob = document.getElementById('newDob').value;
      if (!fname || !lname || !dob) return;
      let members = JSON.parse(localStorage.getItem('familyMembers') || '[]');
      members.push({ fname, lname, dob });
      localStorage.setItem('familyMembers', JSON.stringify(members));
      renderMembers();
      this.reset();
    });

    // Add media form handler
    document.getElementById('addMediaForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const fileInput = document.getElementById('mediaFile');
      const file = fileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        let media = JSON.parse(localStorage.getItem('familyMedia') || '[]');
        media.push({ data: evt.target.result, type: file.type });
        localStorage.setItem('familyMedia', JSON.stringify(media));
        renderMedia();
      };
      reader.readAsDataURL(file);
      this.reset();
    });

    // Initial render
    renderMembers();
    renderMedia();
  </script>
</body>
</html>
